---
title: åŸºäºword2vecçš„çº¢æ¥¼æ¢¦äººç‰©å…³ç³»åˆ†æ
cover: /gallery/cover/hlm.png
thumbnail: /gallery/cover/hlm.png
date: 2021-05-18 17:02:44
tags:
  - word2vec
  - çº¢æ¥¼æ¢¦
categories:
  -	NLP
---

word2vecæ˜¯Googleå…¬å¸åœ¨2013å¹´æå‡ºçš„ä¸€ç§è¯åµŒå…¥ç®—æ³•ã€‚ä½¿ç”¨word2vecç®—æ³•å¯¹è¯æ±‡è¿›è¡Œå‘é‡åŒ–åï¼ŒåŸæ¥çš„è¿‘ä¹‰è¯åœ¨å‘é‡ç©ºé—´ä¸­æ˜¯é‚»è¿‘çš„ï¼Œå› æ­¤word2vecå¯ä»¥å¾ˆå¥½çš„ä¿ç•™åŸæ¥è¯æ±‡ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€‚

<!--more-->

æœ¬æ–‡ä½¿ç”¨gensimåº“å®ç°çš„word2vecç®—æ³•ï¼Œå¯¹çº¢æ¥¼æ¢¦ä¸­çš„äººç‰©å…³ç³»è¿›è¡Œåˆ†æï¼Œå¾—åˆ°äº†è®¸å¤šæœ‰è¶£çš„ç»“è®ºã€‚

# è·å–æ–‡æœ¬

é¦–å…ˆæˆ‘ä»¬éœ€è¦è·å–åŸè‘—çš„æœ¬æ–‡æ–‡ä»¶ï¼Œå¹¶ä¸”éœ€è¦ä¿è¯æ–‡æœ¬æ–‡ä»¶è¶³å¤Ÿã€Œçº¯å‡€ã€ï¼Œå¯ä»¥å‡å°‘æ–‡æœ¬å¤„ç†çš„å·¥ä½œé‡ã€‚

å¯ä»¥é€šè¿‡çˆ¬è™«ï¼Œä»http://www.purepen.comè·å–åŸå§‹æ–‡æœ¬ã€‚

çˆ¬è™«ä»£ç å¦‚ä¸‹ï¼š

~~~python
import requests
import random
import time
from bs4 import BeautifulSoup

def crawler():
    '''
    çˆ¬å–çº¢æ¥¼æ¢¦
    :url
    :return
    '''
    path = 'http://www.purepen.com/hlm/'
    file = open('./data/çº¢æ¥¼æ¢¦.txt', 'w+')
    for page in range(1, 121):
        url = path + ('000'+str(page))[-3:] + '.htm'
        print(url)
        html = requests.get(url)
        html.encoding = html.apparent_encoding
        soup = BeautifulSoup(html.text, 'lxml')
        title = soup.find(align = 'center').text
        print(title)
        content = soup.find(face = 'å®‹ä½“').text
        file.write(title   + '\t\n')
        file.write(content + '\t\n')
        sec = random.randint(0, 3)
        print("Sleep %d sconds." % sec)
        time.sleep(sec)

if __name__ == '__main__':
    crawler()
~~~

ä»£ç ä¸­é€šè¿‡sleepæœºåˆ¶ç®€å•çš„é¿å…äº†è¢«åçˆ¬ã€‚

# æ–‡æœ¬å¤„ç†

é¦–å…ˆéœ€è¦ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å°†æ‰€æœ‰çš„æ ‡ç‚¹ç¬¦å·å»æ‰ã€‚çº¢æ¥¼æ¢¦å±äºåŠç™½è¯æ–‡åŠæ–‡è¨€æ–‡çš„é—®é¢˜ï¼Œå› æ­¤å…¶ä¸­è®¸å¤šè¯è¯­åˆ†è¯ç³»ç»Ÿæ˜¯ä¸èƒ½è¯†åˆ«çš„ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬è¿™æ¬¡åšçš„åªæ˜¯äººç‰©å…³ç³»ï¼Œæ‰€ä»¥åªéœ€è¦æŠŠæ‰€æœ‰çš„äººåå†™å…¥ç”¨æˆ·å­—å…¸å°±å¯ä»¥ä¿è¯æ‰€æœ‰çš„äººåéƒ½èƒ½è¢«å‡†ç¡®åœ°è¯†åˆ«å‡ºæ¥ã€‚

~~~python
def segment():
    start = time.time()
    content = open('./data/çº¢æ¥¼æ¢¦.txt', 'r').read()
    trimed = re.sub(r'[^\u4e00-\u9fa5]', ' ', content)
    jieba.load_userdict('./data/dict.txt')
    result = ' '.join(jieba.cut(trimed))
    file = open('./data/cut_result.txt', 'w+')
    file.write(' '.join(result.split()))
    cost = time.time() - start
    print(f"Segment cost: {cost:.4f}")
~~~

æŒ‰é“ç†åº”è¯¥æ˜¯è¦å»æ‰åœç”¨è¯çš„ï¼Œä¸è¿‡æˆ‘ä¸æƒ³åšï¼Œå·ä¸ªæ‡’ã€‚ğŸ˜›

# æ¨¡å‹è®­ç»ƒ

ä½¿ç”¨gensimå®ç°çš„word2vecç®—æ³•è¿›è¡Œå‘é‡åŒ–ï¼Œå› ä¸ºæ–‡æœ¬ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥å‘é‡é•¿åº¦æˆ‘é€‰æ‹©çš„200ï¼Œwindowå¤§å°é€‰æ‹©çš„3ã€‚

~~~python
def train_model():
    start = time.time()
    sentencePath = './data/cut_result.txt'
    modelPath = './data/hlm_model'
    sentence = word2vec.LineSentence(sentencePath)
    model = word2vec.Word2Vec(sentence, vector_size=200, window=3)
    model.save(modelPath)
    cost = time.time() - start
    print(f'Word2Vec model training cost: {cost:.4f}')
~~~

è®­ç»ƒèµ·æ¥è¿˜æ˜¯å¾ˆå¿«çš„ï¼Œå¤§æ¦‚ä¸€ç§’é’Ÿå°±å¥½äº†ã€‚

# PCAé™ç»´

å› ä¸ºåŸå§‹çš„å‘é‡é•¿åº¦å¤ªå¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆç”¨PCAï¼ˆä¸»æˆåˆ†åˆ†æï¼‰å°†å‘é‡é™åˆ°äºŒç»´ï¼Œç„¶ååœ¨åæ ‡ç³»ä¸­ç”»å‡ºæ¥ã€‚

~~~python
from gensim.models import word2vec
from sklearn.decomposition import PCA
from matplotlib import pyplot

pyplot.rcParams['font.sans-serif'] = ['Arial Unicode MS']

model = word2vec.Word2Vec.load('./data/hlm_model')

allNames = [x.strip('\n') for x in open('./data/name.txt', 'r').readlines()]
X, names = [], []
for name in allNames:
    try:
        X.append(model.wv[name])
        names.append(name)
    except:
        print("missed name: ", name)

pca = PCA(n_components=2)
result = pca.fit_transform(X)

pyplot.scatter(result[:, 0], result[:, 1])
for i, name in enumerate(names):
	pyplot.annotate(name, xy=(result[i, 0], result[i, 1]))
# pyplot.show()
pyplot.savefig('./data/relation.png', transparent=True)
~~~

å› ä¸ºword2vecä¼šå¿½ç•¥æ‰é¢‘æ¬¡æ¯”è¾ƒå°çš„è¯è¯­ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è·å–è¯å‘é‡æ—¶éœ€è¦è¿›è¡Œå¼‚å¸¸æ•æ‰ã€‚

è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ•ˆæœå§ï¼

![æ•´ä½“å›¾ç‰‡](/gallery/others/hlm-all.png)

å› ä¸ºåå­—æœ‰ç‚¹å¤šï¼Œæ•´ä½“çœ‹èµ·æ¥æœ‰ç‚¹æ‹¥æŒ¤ã€‚æˆ‘ä»¬æŠŠç„¦ç‚¹æ”¾åœ¨åˆä¸‹è§’ï¼Œå¯ä»¥çœ‹åˆ°å®é»›é’—ä¸‰ä¸ªäººéƒ½åœ¨ï¼Œæˆ‘ä»¬æ”¾å¤§ä¸€ä¸‹ã€‚

![å³ä¸‹è§’å±€éƒ¨](/gallery/others/hlm-part.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ç‰å’Œé»›ç‰ç´§ç´§æŒ¨ç€ä¸€èµ·ï¼Œå®é»›ä¸€ç”Ÿå¹å¥½å§ï¼

# æœ€ç›¸ä¼¼åˆ†æ

word2vecä¸­æä¾›äº†å‡ ä¸ªæœ‰è¶£çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™äº›æ–¹æ³•è¿›ä¸€æ­¥åˆ†æä¸€ä¸‹äººç‰©å…³ç³»ã€‚

ä»£ç å¦‚ä¸‹ï¼š

~~~python
from gensim.models import word2vec

def analyse():
    model = word2vec.Word2Vec.load('./data/hlm_model')
    print('Nearest å®ç‰:',model.wv.most_similar(['å®ç‰']))
    print('Nearest é»›ç‰:',model.wv.most_similar(['é»›ç‰']))
    print('Nearest å®é’—:',model.wv.most_similar(['å®é’—']))
    print('Nearest æ™´é›¯:',model.wv.most_similar(['æ™´é›¯']))
    print('Nearest è¢­äºº:',model.wv.most_similar(['è¢­äºº']))
    print('Nearest è´¾æ¯:',model.wv.most_similar(['è´¾æ¯']))

    print(model.wv.doesnt_match(u"è´¾å®ç‰ è–›å®é’— æ—é»›ç‰ å²æ¹˜äº‘".split()))
    print(model.wv.doesnt_match(u"é»›ç‰ å…ƒæ˜¥ æ¢æ˜¥ è¿æ˜¥ æƒœæ˜¥".split()))
    print(model.wv.doesnt_match(u"è´¾ç è´¾æ”¿ è´¾èµ¦ è´¾æ•¬".split()))

    print(model.wv.similarity('è´¾å®ç‰','æ—é»›ç‰'))
    print(model.wv.similarity('æ—é»›ç‰','è–›å®é’—'))
    print(model.wv.similarity('æ™´é›¯', 'è¢­äºº'))
    
    print(model.wv.similarity('æ—é»›ç‰','è–›å®é’—'))
    print(model.wv.similarity('æ—é»›ç‰','å®é’—'))
    print(model.wv.similarity('é»›ç‰','è–›å®é’—'))
    print(model.wv.similarity('é»›ç‰','å®é’—'))

    who = model.wv['å®ç‰'] - model.wv['å®é’—'] + model.wv['é»›ç‰']
    print(model.wv.most_similar(positive=[who]))
    who = model.wv['å®ç‰'] - model.wv['é»›ç‰'] + model.wv['å®é’—']
    print(model.wv.most_similar(positive=[who]))
    
if __name__ == '__main__':
    analyse()
~~~

ç»“æœå¦‚ä¸‹ï¼š

~~~tex
Nearest å®ç‰: [('é»›ç‰', 0.9654377102851868), ('è¢­äºº', 0.9432756304740906), ('è´¾ç', 0.9404013156890869), ('ç´«é¹ƒ', 0.9312815070152283), ('æ™´é›¯', 0.9278832674026489), ('é¸³é¸¯', 0.9248123168945312), ('æ¹˜äº‘', 0.9108842015266418), ('å‡¤å§', 0.9095652103424072), ('å®é’—', 0.9087227582931519), ('è–›å§¨å¦ˆ', 0.9083631634712219)]
Nearest é»›ç‰: [('å®ç‰', 0.9654375910758972), ('å®é’—', 0.9516232013702393), ('æ¹˜äº‘', 0.9490573406219482), ('è´¾ç', 0.9195422530174255), ('å–œä¸è‡ªèƒœ', 0.9156811237335205), ('æ™´é›¯', 0.9114517569541931), ('é›¨æ‘', 0.9069087505340576), ('é¸³é¸¯', 0.9047612547874451), ('ç´«é¹ƒ', 0.9041048884391785), ('æœæ’°', 0.9008530974388123)]
Nearest å®é’—: [('æ¢æ˜¥', 0.958204448223114), ('æ¹˜äº‘', 0.9580698609352112), ('é»›ç‰', 0.9516231417655945), ('è´¾ç', 0.9483581185340881), ('æƒœæ˜¥', 0.9394745826721191), ('è–›å§¨å¦ˆ', 0.9329902529716492), ('é›¨æ‘', 0.9322482943534851), ('æœæ’°', 0.9264885783195496), ('ç´«é¹ƒ', 0.9231323003768921), ('å–œä¸è‡ªèƒœ', 0.9216738939285278)]
Nearest æ™´é›¯: [('ç´«é¹ƒ', 0.9769253730773926), ('è¢­äºº', 0.9697536826133728), ('å‡¤å§å„¿', 0.9683317542076111), ('é¦™è±', 0.9670401215553284), ('é¸³é¸¯', 0.9620832800865173), ('æ‹æ‰‹', 0.9574575424194336), ('è–›å§¨å¦ˆ', 0.956330418586731), ('è´¾ç', 0.9559655785560608), ('é™ªç¬‘', 0.9534842371940613), ('æ¹˜äº‘', 0.9519651532173157)]
Nearest è¢­äºº: [('ç´«é¹ƒ', 0.9749440550804138), ('æ™´é›¯', 0.9697537422180176), ('å‡¤å§å„¿', 0.9651725888252258), ('é¸³é¸¯', 0.9604008793830872), ('å¹³å„¿', 0.9592967629432678), ('å‡¤å§', 0.9534151554107666), ('è´¾ç', 0.9518244862556458), ('è–›å§¨å¦ˆ', 0.9457788467407227), ('å®ç‰', 0.9432753920555115), ('é¦™è±', 0.9285346269607544)]
Nearest è´¾æ¯: [('ç‹å¤«äºº', 0.9712321162223816), ('å°¤æ°', 0.9515039324760437), ('è´¾ç', 0.9488133192062378), ('è´¾ç', 0.9456284046173096), ('è–›å§¨å¦ˆ', 0.937038779258728), ('å‡¤å§', 0.9299778938293457), ('é¸³é¸¯', 0.9244546890258789), ('é‚¢å¤«äºº', 0.9219790101051331), ('è´¾è“‰', 0.9125443696975708), ('é›ªé›', 0.9032955765724182)]
å²æ¹˜äº‘
å…ƒæ˜¥
è´¾æ•¬
0.9830096
0.9892198
0.96975374
0.9892198
0.6931182
0.64615595
0.95162314
[('å®ç‰', 0.9627019166946411), ('é»›ç‰', 0.9240608215332031), ('è¢­äºº', 0.8599908351898193), ('æ™´é›¯', 0.8383870720863342), ('ç´«é¹ƒ', 0.8329888582229614), ('è´¾ç', 0.8326756954193115), ('é¸³é¸¯', 0.829352080821991), ('æ¹˜äº‘', 0.8235012292861938), ('ä¸€æƒ³', 0.8234348297119141), ('é¦™è±', 0.8150357007980347)]
[('è´¾ç', 0.9775873422622681), ('å®é’—', 0.964641809463501), ('ç´«é¹ƒ', 0.958747923374176), ('è–›å§¨å¦ˆ', 0.9540018439292908), ('å®ç‰', 0.9533487558364868), ('è¢­äºº', 0.9529389142990112), ('é¸³é¸¯', 0.9496896266937256), ('å‡¤å§', 0.9492440223693848), ('æ™´é›¯', 0.9458354115486145), ('å‡¤å§å„¿', 0.9457259178161621)]
~~~

ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå®ç‰æœ€ç›¸ä¼¼çš„æ˜¯é»›ç‰ï¼Œé»›ç‰æœ€ç›¸ä¼¼çš„æ˜¯å®ç‰ï¼Œè€Œå®é’—æœ€ç›¸ä¼¼çš„æ˜¯æ¢æ˜¥ã€‚

å¹¶ä¸”å¯ä»¥çœ‹åˆ°ã€Œå®ç‰ã€å’Œã€Œé»›ç‰ã€çš„ç›¸ä¼¼åº¦æ¯”ã€Œè´¾å®ç‰ã€å’Œã€Œé»›ç‰ã€çš„ç›¸ä¼¼åº¦æ›´é«˜ï¼Œè¯´æ˜åœ¨æ–‡ä¸­å‰è€…å¾€å¾€æ˜¯æˆå¯¹å‡ºç°çš„ã€‚

å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¾—åˆ°äº†ä¸¤ä¸ªæœ‰è¶£çš„å¼å­ï¼š
$$
å®ç‰ - å®é’— + é»›ç‰ \approx å®ç‰
$$

$$
å®ç‰ - é»›ç‰ + å®é’— \approx è´¾ç
$$



å¾ˆæœ‰æ„æ€ğŸ˜‚

